# 持久化
## RDB：快照

### save
持久化的时候redis服务阻塞

### bgsave

fork( ) + copyonwrite 实现异步 + 非阻塞

- 主进程fork()子进程之后，内核把主进程中所有的内存页的权限都设为read-only，然后子进程的地址空间指向主进程（共享了 fork 瞬间主进程的内存）
- 主进程写内存时，触发页异常中断，陷入内核中断
- 内把**触发的异常**的页复制一份给子进程，于是主子进程各自持有独立的一份



## AOF

每次执行 **修改内存** 中数据集的写操作时，都会追加 **记录** 该操作。

AOF 日志是以文件的形式存在的，当程序对 AOF 日志文件进行写操作时，实际上是将内容写到了内核为文件描述符分配的一个内存缓存中，然后内核会异步将脏数据刷回到磁盘。默认每秒使用 fsync **强制从内核缓存刷到磁盘**。



## 混合持久化

先加载 `rdb` 的内容，然后再重放增量 AOF 日志